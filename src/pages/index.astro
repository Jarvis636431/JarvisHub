---
import Layout from "@layouts/Layout.astro";
import { getCollection } from "astro:content";

// Get latest blog posts
const postsCollection = await getCollection("blog", ({ data }) => {
  return import.meta.env.DEV ? true : data.draft !== true;
});

const sortedPosts = postsCollection
  .sort(
    (a, b) =>
      new Date(b.data.publishDate).getTime() -
      new Date(a.data.publishDate).getTime()
  )
  .slice(0, 3); // Show top 3 posts

// Get featured projects
const projectsCollection = await getCollection("projects", ({ data }) => {
  return import.meta.env.DEV ? true : data.status !== "archived";
});

const featuredProjects = projectsCollection
  .sort(
    (a, b) =>
      new Date(b.data.publishDate).getTime() -
      new Date(a.data.publishDate).getTime()
  )
  .filter(({ data }) => data.featured)
  .slice(0, 4); // Show top 4 featured projects

const stack = [
  "Astro",
  "React",
  "TypeScript",
  "Tailwind",
  "Node.js",
  "Next.js",
  "SwiftUI",
  "Figma",
];

const currentYear = new Date().getFullYear();
---

<style>
  .spotlight-card {
    position: relative;
    overflow: hidden;
  }

  .spotlight-card::after {
    content: "";
    position: absolute;
    inset: 0;
    z-index: 10;
    background: radial-gradient(
      600px circle at var(--mouse-x) var(--mouse-y),
      rgba(47, 111, 109, 0.1),
      transparent 40%
    );
    opacity: 0;
    transition: opacity 0.3s;
    pointer-events: none;
  }

  .spotlight-card:hover::after {
    opacity: 1;
  }

  /* Entrance Animation */
  @keyframes enter {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .animate-card {
    opacity: 0; /* Start hidden */
    animation: enter 0.6s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
  }

  .animate-card:nth-child(1) {
    animation-delay: 0.1s;
  }
  .animate-card:nth-child(2) {
    animation-delay: 0.15s;
  }
  .animate-card:nth-child(3) {
    animation-delay: 0.2s;
  }
  .animate-card:nth-child(4) {
    animation-delay: 0.25s;
  }
  .animate-card:nth-child(5) {
    animation-delay: 0.3s;
  }
  .animate-card:nth-child(6) {
    animation-delay: 0.35s;
  }
  .animate-card:nth-child(7) {
    animation-delay: 0.4s;
  }
  .animate-card:nth-child(8) {
    animation-delay: 0.45s;
  }
  .animate-card:nth-child(9) {
    animation-delay: 0.5s;
  }

  /* Infinite Scroll Animation */
  @keyframes scroll {
    0% {
      transform: translateX(0);
    }
    100% {
      transform: translateX(-50%);
    }
  }

  .animate-scroll {
    display: flex;
    width: max-content; /* Ensure it takes full width of content */
    animation: scroll 20s linear infinite;
  }

  .animate-scroll:hover {
    animation-play-state: paused;
  }

  .mask-linear-fade {
    mask-image: linear-gradient(
      to right,
      transparent,
      black 10%,
      black 90%,
      transparent
    );
    -webkit-mask-image: linear-gradient(
      to right,
      transparent,
      black 10%,
      black 90%,
      transparent
    );
  }
</style>

<Layout title="Jarvis Hub | Command Center">
  <div class="py-12 md:py-20 max-w-7xl mx-auto">
    <!-- Bento Grid Container -->
    <div
      class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-6 auto-rows-[minmax(180px,auto)]"
    >
      <!-- 1. Intro Card (Large, 2x2) -->
      <div
        class="animate-card spotlight-card col-span-1 md:col-span-2 lg:col-span-2 row-span-2 bg-surface border border-black/5 rounded-3xl p-8 flex flex-col justify-between relative group"
      >
        <div
          class="absolute top-0 right-0 p-8 opacity-10 group-hover:opacity-20 transition-opacity"
        >
          <svg width="120" height="120" viewBox="0 0 24 24" fill="currentColor">
            <path
              d="M12 2L2 7l10 5 10-5-10-5zm0 9l2.5-1.25L12 8.5l-2.5 1.25L12 11zm0 2.5l-5-2.5-5 2.5L12 22l10-8.5-5-2.5-5 2.5z"
            ></path>
          </svg>
        </div>
        <div class="space-y-4 relative z-10">
          <div
            class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-green-100/50 border border-green-200 text-green-700 text-xs font-mono tracking-wider uppercase w-fit"
          >
            <span class="relative flex h-2 w-2">
              <span
                class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-500 opacity-75"
              ></span>
              <span
                class="relative inline-flex rounded-full h-2 w-2 bg-green-500"
              ></span>
            </span>
            Available for hire
          </div>

          <div class="h-16 flex items-center -ml-2 overflow-hidden">
            <img
              src="https://readme-typing-svg.herokuapp.com?font=Fira+Code&size=28&pause=1000&color=1A1A1A&center=false&vCenter=true&width=500&lines=Hello%2C+I'm+Jarvis+%F0%9F%91%8B;Full+Stack+Developer;Welcome+to+my+Space!"
              alt="Typing SVG"
            />
          </div>

          <h1 class="sr-only">Hi, I'm Jarvis. Full Stack Developer.</h1>

          <p class="text-lg text-secondary font-body max-w-md leading-relaxed">
            I craft calm, durable interfaces for modern digital products.
            Focused on clarity, speed, and design systems.
          </p>
        </div>
        <div class="pt-8 flex gap-4">
          <a
            href="mailto:hello@jarvishub.com"
            class="px-6 py-3 bg-primary text-background rounded-full font-medium hover:bg-accent-cyan transition-colors shadow-lg shadow-primary/20 hover:shadow-accent-cyan/20"
          >
            Get in touch
          </a>
          <a
            href="/about"
            class="px-6 py-3 bg-white border border-black/10 rounded-full font-medium hover:bg-black/5 transition-colors"
          >
            More about me
          </a>
        </div>
      </div>

      <!-- 2. Location/Map Card (1x1) -->
      <div
        class="animate-card spotlight-card col-span-1 row-span-1 bg-[#242424] rounded-3xl relative group flex flex-col justify-between p-6 text-white"
      >
        <div
          class="absolute inset-0 bg-[url('https://api.mapbox.com/styles/v1/mapbox/dark-v10/static/114.0579,22.5431,11,0/400x400?access_token=pk.eyJ1IjoiamFydmlzaHViIiwiYSI6ImNrbGZ5a3dodTAwMXoycG8xZnJ5a3dodTAifQ.placeholder')] bg-cover bg-center opacity-40 group-hover:opacity-60 transition-opacity duration-500 grayscale group-hover:grayscale-0"
        >
        </div>
        <div
          class="absolute inset-0 bg-gradient-to-t from-black/80 to-transparent"
        >
        </div>
        <div class="relative z-10">
          <p class="text-xs font-mono uppercase tracking-widest text-white/60">
            Based in
          </p>
        </div>
        <div class="relative z-10">
          <h3 class="text-2xl font-display font-bold">Shenzhen, CN</h3>
          <p id="local-time" class="text-sm font-mono text-white/60 mt-1">
            --:-- --
          </p>
        </div>
      </div>

      <!-- 3. Social/Connect Card (1x1) -->
      <div
        class="animate-card spotlight-card col-span-1 row-span-1 bg-[#1da1f2]/10 border border-[#1da1f2]/20 rounded-3xl p-6 flex flex-col justify-center items-center gap-4 group hover:bg-[#1da1f2]/20 transition-colors cursor-pointer"
        onclick="window.open('https://twitter.com/jarvishub', '_blank')"
      >
        <svg
          class="w-12 h-12 text-[#1da1f2] transform group-hover:scale-110 transition-transform duration-300"
          fill="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"
          ></path>
        </svg>
        <p class="font-display font-bold text-[#1da1f2]">@jarvishub</p>
      </div>

      <!-- 4. Contribution Heatmap (2x1) -->
      <div
        class="animate-card spotlight-card col-span-1 md:col-span-2 row-span-1 bg-surface border border-black/5 rounded-3xl p-6 flex flex-col justify-between relative group"
      >
        <div class="flex items-center justify-between mb-4 z-10">
          <h3 class="font-display font-bold text-lg">Contributions</h3>
          <span class="text-xs font-mono text-secondary/60">2024-2025</span>
        </div>

        <div
          class="relative w-full overflow-hidden flex items-center justify-center -ml-2"
        >
          <img
            src="https://ghchart.rshah.org/2f6f6d/Jarvis636431"
            alt="Jarvis636431's Github Chart"
            class="w-full h-auto opacity-80 group-hover:opacity-100 transition-opacity"
          />
        </div>
      </div>

      <!-- 5. Selected Work List (1x2) -->
      <div
        class="animate-card spotlight-card col-span-1 row-span-1 md:row-span-2 bg-black text-white rounded-3xl p-8 flex flex-col relative group"
      >
        <div class="absolute top-0 right-0 p-8 opacity-10 transition-opacity">
          <svg
            width="80"
            height="80"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="1"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"
            ></path>
          </svg>
        </div>
        <h3 class="font-display font-bold text-xl mb-6 z-10">Selected Work</h3>
        <div class="flex flex-col gap-4 z-10">
          {
            featuredProjects.slice(0, 3).map((project) => (
              <a
                href={`/projects/${project.slug}`}
                class="flex items-center justify-between group/item py-2 border-b border-white/10 hover:border-white/30 transition-colors"
              >
                <span class="font-medium group-hover/item:text-accent-cyan transition-colors truncate pr-4">
                  {project.data.title}
                </span>
                <span class="text-white/30 group-hover/item:text-white transition-colors">
                  →
                </span>
              </a>
            ))
          }
        </div>
        <div class="mt-auto pt-6 z-10">
          <a
            href="/projects"
            class="inline-flex items-center gap-2 text-sm text-white/60 hover:text-white transition-colors"
          >
            View Archive <span class="text-xs">↗</span>
          </a>
        </div>
      </div>

      <!-- 6. Tech Stack (1x1) -->
      <div
        class="animate-card spotlight-card col-span-1 row-span-1 bg-surface border border-black/5 rounded-3xl p-6 flex flex-col justify-between overflow-hidden group"
      >
        <h3 class="font-display font-bold text-lg mb-4">Toolkit</h3>
        <div class="relative w-full overflow-hidden mask-linear-fade">
          <div class="flex gap-4 animate-scroll w-max">
            <!-- First Set -->
            <div class="flex gap-4 items-center">
              <img
                src="https://skillicons.dev/icons?i=js,ts,react,vue,next"
                alt="Tech Stack 1"
                class="h-10"
              />
              <img
                src="https://skillicons.dev/icons?i=tailwind,python,go,flutter,nodejs"
                alt="Tech Stack 2"
                class="h-10"
              />
              <img
                src="https://skillicons.dev/icons?i=astro,figma,swift,git,docker"
                alt="Tech Stack 3"
                class="h-10"
              />
            </div>
            <!-- Duplicate Set for Seamless Loop -->
            <div class="flex gap-4 items-center">
              <img
                src="https://skillicons.dev/icons?i=js,ts,react,vue,next"
                alt="Tech Stack 1"
                class="h-10"
              />
              <img
                src="https://skillicons.dev/icons?i=tailwind,python,go,flutter,nodejs"
                alt="Tech Stack 2"
                class="h-10"
              />
              <img
                src="https://skillicons.dev/icons?i=astro,figma,swift,git,docker"
                alt="Tech Stack 3"
                class="h-10"
              />
            </div>
          </div>
        </div>
      </div>

      <!-- 7. GitHub Link (1x1) -->
      <a
        href="https://github.com/Jarvis636431"
        target="_blank"
        class="animate-card spotlight-card col-span-1 row-span-1 bg-black text-white rounded-3xl p-6 flex flex-col justify-between group hover:bg-[#0d1117] transition-colors relative"
      >
        <!-- Snake Background -->
        <div
          class="absolute inset-0 opacity-30 group-hover:opacity-50 transition-opacity pointer-events-none"
        >
          <img
            src="https://raw.githubusercontent.com/Jarvis636431/Jarvis636431/output/github-contribution-grid-snake-dark.svg"
            class="w-full h-full object-cover"
            alt="Contribution Snake"
          />
        </div>

        <div class="flex justify-between items-start z-10">
          <svg
            class="w-8 h-8 text-white"
            fill="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              fill-rule="evenodd"
              d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z"
              clip-rule="evenodd"></path>
          </svg>
          <span class="text-white/50 group-hover:text-white transition-colors"
            >↗</span
          >
        </div>
        <div class="z-10">
          <p class="font-mono text-sm text-white/60 mb-1">Open Source</p>
          <p class="font-display font-bold">GitHub</p>
        </div>
      </a>

      <!-- 8. Writing Snippets (1x2) -->
      <div
        class="animate-card spotlight-card col-span-1 row-span-1 md:row-span-2 bg-[#f8f7f4] border border-black/5 rounded-3xl p-6 md:p-8 flex flex-col relative"
      >
        <div class="flex items-center justify-between mb-6">
          <h3 class="font-display font-bold text-xl">Recent Writing</h3>
          <a
            href="/blog"
            class="text-accent-cyan hover:text-primary transition-colors"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-5 w-5"
              viewBox="0 0 20 20"
              fill="currentColor"
            >
              <path
                fill-rule="evenodd"
                d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z"
                clip-rule="evenodd"></path>
            </svg>
          </a>
        </div>

        <div class="flex flex-col gap-4 overflow-y-auto pr-2 custom-scrollbar">
          {
            sortedPosts.map((post) => (
              <a
                href={`/blog/${post.slug}`}
                class="group bg-white p-4 rounded-xl border border-black/5 shadow-sm hover:shadow-md hover:border-accent-cyan/20 transition-all"
              >
                <span class="text-xs font-mono text-secondary/60 mb-1 block">
                  {new Date(post.data.publishDate).toLocaleDateString("en-US", {
                    month: "short",
                    day: "numeric",
                  })}
                </span>
                <h4 class="font-display font-semibold text-primary group-hover:text-accent-cyan transition-colors leading-snug">
                  {post.data.title}
                </h4>
              </a>
            ))
          }
        </div>
      </div>

      <!-- 9. Philosophy/Quote (2x1) -->
      <div
        class="col-span-1 md:col-span-2 row-span-1 bg-[#1a1a1a] rounded-3xl p-8 flex items-center justify-center relative overflow-hidden text-center group"
      >
        <div
          class="absolute inset-0 bg-gradient-to-r from-purple-900/20 to-blue-900/20 opacity-0 group-hover:opacity-100 transition-opacity duration-700"
        >
        </div>
        <blockquote class="relative z-10 max-w-lg">
          <p
            class="font-serif text-2xl md:text-3xl text-white/90 italic leading-relaxed"
          >
            "Talk is cheap. Show me the code."
          </p>
          <footer
            class="mt-4 text-sm text-white/40 font-mono uppercase tracking-widest"
          >
            — Linus Torvalds
          </footer>
        </blockquote>
      </div>
    </div>
  </div>
</Layout>

<script>
  // Update local time for Shenzhen (UTC+8)
  function updateTime() {
    const timeDisplay = document.getElementById("local-time");
    if (timeDisplay) {
      const now = new Date();
      const options = {
        timeZone: "Asia/Shanghai",
        hour: "2-digit",
        minute: "2-digit",
        hour12: false,
      };
      // @ts-ignore
      const timeString = now.toLocaleTimeString("en-US", options);
      timeDisplay.textContent = timeString + " UTC+8";
    }
  }

  setInterval(updateTime, 1000);
  updateTime();
</script>
