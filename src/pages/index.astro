---
import Layout from "@layouts/Layout.astro";
import { getCollection } from "astro:content";

// Get latest blog posts
const postsCollection = await getCollection("blog", ({ data }) => {
  return import.meta.env.DEV ? true : data.draft !== true;
});

const sortedPosts = postsCollection
  .sort(
    (a, b) =>
      new Date(b.data.publishDate).getTime() -
      new Date(a.data.publishDate).getTime()
  )
  .slice(0, 3); // Show top 3 posts

// Get featured projects
const projectsCollection = await getCollection("projects", ({ data }) => {
  return import.meta.env.DEV ? true : data.status !== "archived";
});

const featuredProjects = projectsCollection
  .sort(
    (a, b) =>
      new Date(b.data.publishDate).getTime() -
      new Date(a.data.publishDate).getTime()
  )
  .filter(({ data }) => data.featured)
  .slice(0, 4); // Show top 4 featured projects

const stack = [
  "Astro",
  "React",
  "TypeScript",
  "Tailwind",
  "Node.js",
  "Next.js",
  "SwiftUI",
  "Figma",
];

const currentYear = new Date().getFullYear();
---

<style>
  .spotlight-card {
    position: relative;
    overflow: hidden;
  }

  .spotlight-card::after {
    content: "";
    position: absolute;
    inset: 0;
    z-index: 10;
    background: radial-gradient(
      600px circle at var(--mouse-x) var(--mouse-y),
      rgba(47, 111, 109, 0.1),
      transparent 40%
    );
    opacity: 0;
    transition: opacity 0.3s;
    pointer-events: none;
  }

  .spotlight-card:hover::after {
    opacity: 1;
  }

  /* Entrance Animation */
  @keyframes enter {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .animate-card {
    opacity: 0; /* Start hidden */
    animation: enter 0.6s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
  }

  .animate-card:nth-child(1) {
    animation-delay: 0.1s;
  }
  .animate-card:nth-child(2) {
    animation-delay: 0.15s;
  }
  .animate-card:nth-child(3) {
    animation-delay: 0.2s;
  }
  .animate-card:nth-child(4) {
    animation-delay: 0.25s;
  }
  .animate-card:nth-child(5) {
    animation-delay: 0.3s;
  }
  .animate-card:nth-child(6) {
    animation-delay: 0.35s;
  }
  .animate-card:nth-child(7) {
    animation-delay: 0.4s;
  }
  .animate-card:nth-child(8) {
    animation-delay: 0.45s;
  }
  .animate-card:nth-child(9) {
    animation-delay: 0.5s;
  }

  /* Infinite Scroll Animation */
  @keyframes scroll {
    0% {
      transform: translateX(0);
    }
    100% {
      transform: translateX(-50%);
    }
  }

  .animate-scroll {
    display: flex;
    width: max-content; /* Ensure it takes full width of content */
    animation: scroll 20s linear infinite;
  }

  .animate-scroll:hover {
    animation-play-state: paused;
  }

  .mask-linear-fade {
    mask-image: linear-gradient(
      to right,
      transparent,
      black 10%,
      black 90%,
      transparent
    );
    -webkit-mask-image: linear-gradient(
      to right,
      transparent,
      black 10%,
      black 90%,
      transparent
    );
  }

  /* Music Bar Animation */
  @keyframes music-bar {
    0%,
    100% {
      height: 20%;
    }
    50% {
      height: 100%;
    }
  }
  .animate-music-bar-1 {
    animation: music-bar 0.8s ease-in-out infinite;
    height: 40%;
  }
  .animate-music-bar-2 {
    animation: music-bar 1.1s ease-in-out infinite;
    height: 90%;
  }
  .animate-music-bar-3 {
    animation: music-bar 0.9s ease-in-out infinite;
    height: 50%;
  }

  /* Grid Pattern Background */
  .bg-grid-pattern {
    background-size: 40px 40px;
    background-image: linear-gradient(
        to right,
        rgba(0, 0, 0, 0.03) 1px,
        transparent 1px
      ),
      linear-gradient(to bottom, rgba(0, 0, 0, 0.03) 1px, transparent 1px);
    mask-image: linear-gradient(to bottom right, black 40%, transparent 100%);
    -webkit-mask-image: linear-gradient(
      to bottom right,
      black 40%,
      transparent 100%
    );
  }
</style>

<Layout title="Jarvis Hub | Command Center">
  <div class="py-12 md:py-20 max-w-7xl mx-auto">
    <!-- Bento Grid Container -->
    <div
      class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-6 auto-rows-[minmax(180px,auto)]"
    >
      <!-- 1. Intro Card (Large, 2x2) -->
      <div
        class="animate-card spotlight-card col-span-1 md:col-span-2 lg:col-span-2 row-span-2 bg-surface border border-black/5 rounded-3xl p-8 flex flex-col justify-between relative group overflow-hidden"
      >
        <!-- Grid Background -->
        <div
          class="absolute inset-0 bg-grid-pattern opacity-100 pointer-events-none"
        >
        </div>

        <div class="space-y-8 relative z-10">
          <div class="space-y-4">
            <h1
              class="text-4xl md:text-5xl lg:text-6xl font-display font-bold tracking-tight text-primary leading-[1.1]"
            >
              Hi, I'm <span class="text-accent-cyan">Jarvis</span>.
            </h1>
            <p class="text-lg text-secondary/80 max-w-md leading-relaxed">
              Full Stack Developer. <br />
              Building calm & durable interfaces.
            </p>
          </div>
        </div>

        <div class="pt-8 flex gap-4 relative z-10">
          <a
            href="mailto:hello@jarvishub.com"
            class="px-6 py-3 bg-primary text-background rounded-full font-medium hover:bg-accent-cyan transition-all shadow-lg shadow-primary/20 hover:shadow-accent-cyan/20 hover:-translate-y-0.5"
          >
            Get in touch
          </a>
          <a
            href="/about"
            class="px-6 py-3 bg-white border border-black/10 rounded-full font-medium hover:bg-black/5 transition-colors"
          >
            More about me
          </a>
        </div>
      </div>

      <!-- 2. Location/Map Card (1x1) -->
      <div
        class="animate-card spotlight-card col-span-1 row-span-1 bg-[#242424] rounded-3xl relative group flex flex-col justify-between p-6 text-white"
      >
        <div
          class="absolute inset-0 bg-[url('https://api.mapbox.com/styles/v1/mapbox/dark-v10/static/116.4074,39.9042,10,0/400x400?access_token=pk.eyJ1IjoiamFydmlzaHViIiwiYSI6ImNrbGZ5a3dodTAwMXoycG8xZnJ5a3dodTAifQ.placeholder')] bg-cover bg-center opacity-40 group-hover:opacity-60 transition-opacity duration-500 grayscale group-hover:grayscale-0"
        >
        </div>
        <div
          class="absolute inset-0 bg-gradient-to-t from-black/80 to-transparent"
        >
        </div>
        <div class="relative z-10">
          <p class="text-xs font-mono uppercase tracking-widest text-white/60">
            Based in
          </p>
        </div>
        <div class="relative z-10">
          <h3 class="text-2xl font-display font-bold">Beijing, CN</h3>
          <p id="local-time" class="text-sm font-mono text-white/60 mt-1">
            --:-- --
          </p>
        </div>
      </div>

      <!-- 3. Music/Vibe Card (1x1) -->
      <div
        class="animate-card spotlight-card col-span-1 row-span-1 bg-[#1DB954]/10 border border-[#1DB954]/20 rounded-3xl p-6 flex flex-col justify-between group hover:bg-[#1DB954]/20 transition-colors relative overflow-hidden"
      >
        <div class="flex justify-between items-start z-10">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="w-8 h-8 text-[#1DB954]"
            viewBox="0 0 24 24"
            fill="currentColor"
          >
            <path
              d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm4.586 14.424c-.188.309-.586.411-.894.223-2.449-1.496-5.534-1.833-9.168-1.004-.339.077-.678-.142-.755-.481-.077-.339.142-.678.481-.755 4.032-.919 7.494-.523 10.314 1.2.308.188.411.586.223.894zm1.28-2.849c-.237.385-.738.511-1.123.274-2.812-1.728-7.1-2.231-10.426-1.221-.434.132-.893-.119-1.025-.553-.132-.434.119-.893.553-1.025 3.844-1.166 8.653-.598 11.903 1.402.385.237.511.738.274 1.123zm.116-3.037c-3.37-2.001-8.928-2.185-12.146-1.209-.508.154-1.045-.135-1.199-.643-.154-.508.135-1.045.643-1.199 3.733-1.132 9.873-.919 13.785 1.404.463.275.614.877.34 1.34-.275.463-.877.614-1.34.34z"
            ></path>
          </svg>
          <div class="flex gap-1 items-end h-6">
            <span
              class="w-1 bg-[#1DB954] animate-music-bar-1 block rounded-full"
            ></span>
            <span
              class="w-1 bg-[#1DB954] animate-music-bar-2 block rounded-full"
            ></span>
            <span
              class="w-1 bg-[#1DB954] animate-music-bar-3 block rounded-full"
            ></span>
          </div>
        </div>
        <div class="z-10">
          <p class="font-mono text-xs text-[#1DB954]/80 mb-1">On Repeat</p>
          <p class="font-display font-bold text-[#1DB954] leading-tight">
            Coding Vibes
          </p>
        </div>
      </div>

      <!-- 4. Contribution Heatmap (2x1) -->
      <div
        class="animate-card spotlight-card col-span-1 md:col-span-2 row-span-1 bg-surface border border-black/5 rounded-3xl p-6 flex flex-col justify-between relative group"
      >
        <div class="flex items-center justify-between mb-4 z-10">
          <h3 class="font-display font-bold text-lg">Contributions</h3>
          <span class="text-xs font-mono text-secondary/60">2024-2025</span>
        </div>

        <div
          class="relative w-full overflow-hidden flex items-center justify-center -ml-2"
        >
          <img
            src="https://ghchart.rshah.org/2f6f6d/Jarvis636431"
            alt="Jarvis636431's Github Chart"
            class="w-full h-auto opacity-80 group-hover:opacity-100 transition-opacity"
          />
        </div>
      </div>

      <!-- 5. Selected Work List (1x2) -->
      <div
        class="animate-card spotlight-card col-span-1 row-span-1 md:row-span-2 bg-black text-white rounded-3xl p-8 flex flex-col relative group"
      >
        <div class="absolute top-0 right-0 p-8 opacity-10 transition-opacity">
          <svg
            width="80"
            height="80"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="1"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"
            ></path>
          </svg>
        </div>
        <h3 class="font-display font-bold text-xl mb-6 z-10">Selected Work</h3>
        <div class="flex flex-col gap-4 z-10">
          {
            featuredProjects.slice(0, 3).map((project) => (
              <a
                href={`/projects/${project.slug}`}
                class="flex items-center justify-between group/item py-2 border-b border-white/10 hover:border-white/30 transition-colors"
              >
                <span class="font-medium group-hover/item:text-accent-cyan transition-colors truncate pr-4">
                  {project.data.title}
                </span>
                <span class="text-white/30 group-hover/item:text-white transition-colors">
                  →
                </span>
              </a>
            ))
          }
        </div>
        <div class="mt-auto pt-6 z-10">
          <a
            href="/projects"
            class="inline-flex items-center gap-2 text-sm text-white/60 hover:text-white transition-colors"
          >
            View Archive <span class="text-xs">↗</span>
          </a>
        </div>
      </div>

      <!-- 6. Tech Stack (1x1) -->
      <div
        class="animate-card spotlight-card col-span-1 row-span-1 bg-surface border border-black/5 rounded-3xl p-6 flex flex-col justify-between overflow-hidden group"
      >
        <h3 class="font-display font-bold text-lg mb-4">Toolkit</h3>
        <div class="relative w-full overflow-hidden mask-linear-fade">
          <div class="flex gap-4 animate-scroll w-max">
            <!-- First Set -->
            <div class="flex gap-4 items-center">
              <img
                src="https://skillicons.dev/icons?i=js,ts,react,vue,next"
                alt="Tech Stack 1"
                class="h-10"
              />
              <img
                src="https://skillicons.dev/icons?i=tailwind,python,go,flutter,nodejs"
                alt="Tech Stack 2"
                class="h-10"
              />
              <img
                src="https://skillicons.dev/icons?i=astro,figma,swift,git,docker"
                alt="Tech Stack 3"
                class="h-10"
              />
            </div>
            <!-- Duplicate Set for Seamless Loop -->
            <div class="flex gap-4 items-center">
              <img
                src="https://skillicons.dev/icons?i=js,ts,react,vue,next"
                alt="Tech Stack 1"
                class="h-10"
              />
              <img
                src="https://skillicons.dev/icons?i=tailwind,python,go,flutter,nodejs"
                alt="Tech Stack 2"
                class="h-10"
              />
              <img
                src="https://skillicons.dev/icons?i=astro,figma,swift,git,docker"
                alt="Tech Stack 3"
                class="h-10"
              />
            </div>
          </div>
        </div>
      </div>

      <!-- 7. GitHub Link (1x1) -->
      <a
        href="https://github.com/Jarvis636431"
        target="_blank"
        class="animate-card spotlight-card col-span-1 row-span-1 bg-black text-white rounded-3xl p-6 flex flex-col justify-between group hover:bg-[#0d1117] transition-colors relative"
      >
        <!-- Snake Background -->
        <div
          class="absolute inset-0 opacity-30 group-hover:opacity-50 transition-opacity pointer-events-none"
        >
          <img
            src="https://raw.githubusercontent.com/Jarvis636431/Jarvis636431/output/github-contribution-grid-snake-dark.svg"
            class="w-full h-full object-cover"
            alt="Contribution Snake"
          />
        </div>

        <div class="flex justify-between items-start z-10">
          <svg
            class="w-8 h-8 text-white"
            fill="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              fill-rule="evenodd"
              d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z"
              clip-rule="evenodd"></path>
          </svg>
          <span class="text-white/50 group-hover:text-white transition-colors"
            >↗</span
          >
        </div>
        <div class="z-10">
          <p class="font-mono text-sm text-white/60 mb-1">Open Source</p>
          <p class="font-display font-bold">GitHub</p>
        </div>
      </a>

      <!-- 8. Writing Snippets (1x2) -->
      <div
        class="animate-card spotlight-card col-span-1 row-span-1 md:row-span-2 bg-[#f8f7f4] border border-black/5 rounded-3xl p-6 md:p-8 flex flex-col relative"
      >
        <div class="flex items-center justify-between mb-6">
          <h3 class="font-display font-bold text-xl">Recent Writing</h3>
          <a
            href="/blog"
            class="text-accent-cyan hover:text-primary transition-colors"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-5 w-5"
              viewBox="0 0 20 20"
              fill="currentColor"
            >
              <path
                fill-rule="evenodd"
                d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z"
                clip-rule="evenodd"></path>
            </svg>
          </a>
        </div>

        <div class="flex flex-col gap-4 overflow-y-auto pr-2 custom-scrollbar">
          {
            sortedPosts.map((post) => (
              <a
                href={`/blog/${post.slug}`}
                class="group bg-white p-4 rounded-xl border border-black/5 shadow-sm hover:shadow-md hover:border-accent-cyan/20 transition-all"
              >
                <span class="text-xs font-mono text-secondary/60 mb-1 block">
                  {new Date(post.data.publishDate).toLocaleDateString("en-US", {
                    month: "short",
                    day: "numeric",
                  })}
                </span>
                <h4 class="font-display font-semibold text-primary group-hover:text-accent-cyan transition-colors leading-snug">
                  {post.data.title}
                </h4>
              </a>
            ))
          }
        </div>
      </div>

      <!-- 9. Philosophy/Quote (2x1) -->
      <div
        class="col-span-1 md:col-span-2 row-span-1 bg-[#1a1a1a] rounded-3xl p-8 flex items-center justify-center relative overflow-hidden text-center group"
      >
        <div
          class="absolute inset-0 bg-gradient-to-r from-purple-900/20 to-blue-900/20 opacity-0 group-hover:opacity-100 transition-opacity duration-700"
        >
        </div>
        <blockquote class="relative z-10 max-w-lg">
          <p
            class="font-serif text-2xl md:text-3xl text-white/90 italic leading-relaxed"
          >
            "Talk is cheap. Show me the code."
          </p>
          <footer
            class="mt-4 text-sm text-white/40 font-mono uppercase tracking-widest"
          >
            — Linus Torvalds
          </footer>
        </blockquote>
      </div>
    </div>
  </div>
</Layout>

<script>
  // Update local time for Shenzhen (UTC+8)
  function updateTime() {
    const timeDisplay = document.getElementById("local-time");
    if (timeDisplay) {
      const now = new Date();
      const options = {
        timeZone: "Asia/Shanghai",
        hour: "2-digit",
        minute: "2-digit",
        hour12: false,
      };
      // @ts-ignore
      const timeString = now.toLocaleTimeString("en-US", options);
      timeDisplay.textContent = timeString + " UTC+8";
    }
  }

  setInterval(updateTime, 1000);
  updateTime();
</script>
