---
import Layout from "@layouts/Layout.astro";
import ProjectCard from "@components/ProjectCard.astro";
import { getCollection } from "astro:content";

const postsCollection = await getCollection("blog", ({ data }) => {
  return import.meta.env.DEV ? true : data.draft !== true;
});

const sortedPosts = postsCollection
  .sort(
    (a, b) =>
      new Date(b.data.publishDate).getTime() -
      new Date(a.data.publishDate).getTime(),
  )
  .slice(0, 4);

const projectsCollection = await getCollection("projects", ({ data }) => {
  return import.meta.env.DEV ? true : data.status !== "archived";
});

const sortedProjects = projectsCollection
  .sort(
    (a, b) =>
      new Date(b.data.publishDate).getTime() -
      new Date(a.data.publishDate).getTime(),
  )
  .filter(({ data }) => data.featured)
  .slice(0, 4);

---

<Layout title="Jarvis Hub | Command Center">
  <section id="hero" class="py-20 md:py-28">
    <div class="max-w-3xl space-y-6">
      <p class="text-sm uppercase tracking-widest text-secondary font-mono">
        Jarvis Hub
      </p>
      <h1 class="text-4xl md:text-6xl font-display leading-tight">
        Calm, durable interfaces for modern digital products.
      </h1>
      <p
        id="hero-typewriter"
        class="text-lg text-secondary leading-relaxed font-mono min-h-[72px]"
      >
        {/* Text will be injected via JS */}
      </p>
      <div class="flex flex-wrap gap-4">
        <a
          href="#projects"
          class="px-5 py-2.5 bg-primary text-background rounded-full text-sm font-medium hover:bg-accent-cyan hover:text-white transition-colors"
        >
          View projects
        </a>
        <a
          href="/blog"
          class="px-5 py-2.5 border border-black/15 text-primary rounded-full text-sm font-medium hover:border-accent-cyan hover:text-accent-cyan transition-colors"
        >
          Read writing
        </a>
      </div>
    </div>
  </section>

  <section id="projects" class="mb-24">
    <div class="flex items-end justify-between mb-8 border-b border-black/10 pb-4">
      <div>
        <h2 class="text-3xl md:text-4xl font-display mb-2">Projects</h2>
        <p class="text-secondary text-sm">Selected work</p>
      </div>
      <a
        href="/projects"
        class="hidden md:flex items-center gap-2 text-accent-cyan text-sm hover:text-primary transition-colors"
      >
        View all
      </a>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      {sortedProjects.map((project) => (
        <ProjectCard project={project} />
      ))}
    </div>

    <div class="mt-6 text-center md:hidden">
      <a
        href="/projects"
        class="inline-block px-5 py-2 border border-black/10 text-accent-cyan text-sm rounded-full hover:border-accent-cyan transition-colors"
      >
        View all
      </a>
    </div>
  </section>

  <section id="writing" class="mb-24">
    <div class="grid md:grid-cols-12 gap-10">
      <div class="md:col-span-4">
        <h2 class="text-3xl font-display mb-4">Writing</h2>
        <p class="text-secondary mb-6">
          Essays and practical notes on design systems and product work.
        </p>
        <a
          href="/blog"
          class="inline-flex items-center gap-2 text-sm text-accent-cyan hover:text-primary transition-colors"
        >
          View archive
        </a>
      </div>

      <div class="md:col-span-8">
        <div class="space-y-2 text-sm">
          {
            sortedPosts.map((post, i) => (
              <a
                href={`/blog/${post.slug}`}
                class="group flex items-center gap-4 p-4 border-b border-black/5 hover:bg-black/5 transition-colors"
              >
                <span class="text-secondary/60 font-mono">0{i + 1}</span>
                <div class="flex-1">
                  <h3 class="text-primary group-hover:text-accent-cyan transition-colors truncate">
                    {post.data.title}
                  </h3>
                </div>
                <span class="text-secondary/60 text-xs whitespace-nowrap hidden sm:block">
                  {new Date(post.data.publishDate).toLocaleDateString("en-US", {
                    month: "2-digit",
                    day: "2-digit",
                    year: "numeric",
                  })}
                </span>
              </a>
            ))
          }
        </div>
      </div>
    </div>
  </section>

  <section
    id="contact"
    class="relative overflow-hidden border border-black/10 rounded-2xl py-16 px-6 text-center bg-surface"
  >
    <div class="relative z-10 max-w-2xl mx-auto">
      <p class="font-mono text-secondary text-sm mb-3 tracking-widest uppercase">
        Contact
      </p>
      <h2 class="text-4xl md:text-5xl font-display mb-6">
        Let's build something simple and effective.
      </h2>
      <p class="text-lg text-secondary mb-8">
        Open to collaborations, product strategy, and design system work.
      </p>
      <a
        href="mailto:hello@jarvishub.com"
        class="inline-block px-8 py-3 bg-primary text-background text-sm font-medium rounded-full hover:bg-accent-cyan hover:text-white transition-colors"
      >
        Email me
      </a>
    </div>
  </section>
</Layout>

<script>
  // Typing Effect
  const text =
    "> Product-minded developer\n> Focused on clarity, speed, and systems\n> Based in Shenzhen.";
  const speed = 30; // ms per char
  const element = document.getElementById("hero-typewriter");

  let i = 0;
  function typeWriter() {
    if (element && i < text.length) {
      if (text.charAt(i) === "\n") {
        element.innerHTML += "<br/>";
      } else {
        element.innerHTML += text.charAt(i);
      }
      i++;
      setTimeout(typeWriter, speed);
    }
  }

  // Start typing when page loads
  window.addEventListener("load", typeWriter);
</script>
