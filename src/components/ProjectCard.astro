---
import { Image } from "astro:assets";
import type { CollectionEntry } from "astro:content";

type ProjectEntry = CollectionEntry<"projects">;

const { project } = Astro.props as { project: ProjectEntry };

const publishDate = new Date(project.data.publishDate).toLocaleDateString(
  "en-US",
  {
    year: "numeric",
    month: "short",
  },
);

const link = project.data.externalUrl ?? `/projects/${project.slug}`;
const linkLabel = project.data.externalUrl ? "VISIT_SITE" : "READ_LOG";
---

<a
  class="group relative flex flex-col gap-4 bg-surface border border-black/10 rounded-lg hover:border-accent-cyan transition-colors overflow-hidden"
  href={link}
>
  {
    project.data.coverImage && (
      <div class="relative w-full h-48 overflow-hidden bg-surface">
        <Image
          src={project.data.coverImage}
          alt={project.data.title}
          width={800}
          height={450}
          format="webp"
          loading="lazy"
          class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"
        />
      </div>
    )
  }

  <div class="p-6 flex flex-col gap-4 flex-1">
    <div
      class="flex items-center justify-between gap-4 text-xs font-mono text-secondary"
    >
      <span
        class={`px-2 py-1 rounded-full border ${
          project.data.status === "launched"
            ? "bg-green-100 border-green-300 text-green-700"
            : project.data.status === "in-progress"
              ? "bg-amber-100 border-amber-300 text-amber-700"
              : "bg-black/5 border-black/10 text-secondary"
        }`}
      >
        {project.data.status}
      </span>
      <span>{publishDate}</span>
    </div>

    <div>
      <h3
        class="text-xl font-display leading-tight text-primary group-hover:text-accent-cyan transition-colors"
      >
        {project.data.title}
      </h3>
      <p
        class="text-secondary leading-relaxed text-sm"
      >
        {project.data.summary}
      </p>
    </div>

    {
      project.data.roles.length > 0 && (
        <p class="text-xs font-mono text-secondary/70 uppercase tracking-wider">
          Roles: {project.data.roles.join(", ")}
        </p>
      )
    }

    {
      project.data.stack.length > 0 && (
        <ul class="flex flex-wrap gap-2 mt-auto pt-4 border-t border-black/5">
          {project.data.stack.map((item) => (
            <li class="px-2 py-1 bg-black/5 text-[11px] text-secondary rounded-full">
              {item}
            </li>
          ))}
        </ul>
      )
    }
  </div>
</a>
